<!DOCTYPE html>
<html lang="id">
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <?!= include('style'); ?>
</head>
<body>

  <div id="loading-overlay" class="d-none position-fixed w-100 h-100 top-0 start-0 bg-white d-flex align-items-center justify-content-center" style="z-index: 9999; opacity: 0.9;">
    <div class="text-center">
      <div class="spinner-custom mb-3 mx-auto"></div>
      <h6 class="fw-bold text-dark">Memproses Data...</h6>
    </div>
  </div>

  <div id="login-section" class="d-flex align-items-center justify-content-center vh-100 bg-light">
    <div class="card p-5 border-0 shadow-lg" style="width: 400px; border-radius: 20px;">
      <div class="text-center mb-4">
        <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center mx-auto mb-3" style="width: 60px; height: 60px;">
          <i class="material-icons fs-2">local_fire_department</i>
        </div>
        <h4 class="fw-bold">SiGAS PRO</h4>
        <small class="text-muted">Login Administrator</small>
      </div>
      <input type="text" id="username" class="form-control mb-3 py-2" placeholder="Username (admin)">
      <input type="password" id="password" class="form-control mb-4 py-2" placeholder="Password (admin123)">
      <button onclick="handleLogin()" class="btn btn-primary w-100 py-2 fw-bold rounded-pill">MASUK DASHBOARD</button>
      <div id="login-msg" class="text-center mt-3 text-danger small"></div>
    </div>
  </div>

  <div id="main-app" class="d-none">

    <nav class="sidebar">
      <div class="sidebar-header">
        <i class="material-icons me-2 text-white">local_fire_department</i>
        <span class="fs-5 fw-bold text-white">SiGAS PRO</span>
      </div>

      <div class="d-flex flex-column p-3 gap-1 h-100 overflow-auto">
        <small class="text-uppercase text-muted fw-bold mb-2 ps-3" style="font-size: 11px;">Utama</small>

        <a href="#" onclick="event.preventDefault(); showPage('dashboard')" class="nav-link active" id="nav-dashboard">
          <i class="material-icons align-middle">grid_view</i> Dashboard
        </a>
        <a href="#" onclick="event.preventDefault(); showPage('kasir')" class="nav-link" id="nav-kasir">
          <i class="material-icons align-middle">point_of_sale</i> Kasir Jual
        </a>

        <small class="text-uppercase text-muted fw-bold mb-2 mt-3 ps-3" style="font-size: 11px;">Manajemen Data</small>

        <a href="#" onclick="event.preventDefault(); showPage('produk')" class="nav-link" id="nav-produk">
          <i class="material-icons align-middle">inventory_2</i> Data Produk
        </a>
        <a href="#" onclick="event.preventDefault(); showPage('pelanggan')" class="nav-link" id="nav-pelanggan">
          <i class="material-icons align-middle">group</i> Pelanggan
        </a>
        <a href="#" data-bs-target="#submenu-riwayat" data-bs-toggle="collapse" onclick="event.preventDefault()" class="nav-link d-flex justify-content-between align-items-center">
          <span><i class="material-icons align-middle">history</i> Riwayat</span>
          <i class="material-icons" style="font-size:16px;">expand_more</i>
        </a>

        <div class="collapse ms-3 border-start ps-2" id="submenu-riwayat">
          <a href="#" onclick="event.preventDefault(); showPage('riwayat-jual')" class="nav-link py-2" style="font-size: 14px;"> Penjualan</a>
          <a href="#" onclick="event.preventDefault(); showPage('riwayat-beli')" class="nav-link py-2" style="font-size: 14px;"> Pembelian</a>
          <a href="#" onclick="event.preventDefault(); showPage('riwayat-piutang')" class="nav-link py-2 text-danger fw-bold" style="font-size: 14px;"> Piutang (Bon)</a>
        </div>
        <a href="#" onclick="event.preventDefault(); showPage('pembelian')" class="nav-link" id="nav-pembelian">
          <i class="material-icons align-middle">shopping_bag</i> Stok Masuk
        </a>

        <small class="text-uppercase text-muted fw-bold mb-2 mt-3 ps-3" style="font-size: 11px;">Keuangan & SDM</small>

        <a href="#" onclick="event.preventDefault(); showPage('keuangan')" class="nav-link" id="nav-keuangan">
          <i class="material-icons align-middle">account_balance_wallet</i> Arus Kas
        </a>
        <a href="#" onclick="event.preventDefault(); showPage('payroll')" class="nav-link" id="nav-payroll">
          <i class="material-icons align-middle">badge</i> Payroll (Gaji)
        </a>
        <a href="#" onclick="event.preventDefault(); showPage('laporan')" class="nav-link" id="nav-laporan">
          <i class="material-icons align-middle">assessment</i> Laporan
        </a>
      </div>
    </nav>

    <div class="main-wrapper">

      <header class="top-header">
        <div class="d-flex align-items-center">
          <button class="btn btn-light d-md-none me-2" onclick="document.querySelector('.sidebar').classList.toggle('active')">
            <i class="material-icons">menu</i>
          </button>
          <h5 class="m-0 fw-bold text-dark">Admin Dashboard</h5>
        </div>

        <div class="d-flex align-items-center gap-3">
          <div class="position-relative" style="cursor: pointer;" onclick="cekNotifHutang()">
            <i class="material-icons text-muted" style="font-size: 26px;">notifications</i>
            <span id="notif-badge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger d-none" style="font-size: 10px;">
              0
            </span>
          </div>

          <div class="dropdown">
            <div class="user-profile d-flex align-items-center ps-3 border-start" role="button" data-bs-toggle="dropdown" aria-expanded="false" style="cursor: pointer;">
              <div class="text-end me-2 lh-1 d-none d-sm-block">
                <div class="fw-bold text-dark" style="font-size: 14px;" id="display-user">Admin</div>
                <small class="text-muted" style="font-size: 11px;">Administrator</small>
              </div>
              <div class="user-avatar bg-danger text-white rounded-circle d-flex align-items-center justify-content-center shadow-sm" style="width: 40px; height: 40px;">
                <i class="material-icons" style="font-size: 24px;">person</i>
              </div>
            </div>

            <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg mt-2" style="border-radius: 12px; min-width: 200px;">
              <li class="px-3 py-2 border-bottom">
                <span class="fw-bold d-block text-dark">Akun Saya</span>
                <small class="text-muted" style="font-size: 11px;">Kelola profil & keamanan</small>
              </li>
              <li><a class="dropdown-item py-2 mt-1" href="#"><i class="material-icons align-middle me-2 fs-6 text-muted">settings</i> Pengaturan</a></li>
              <li><hr class="dropdown-divider"></li>
              <li>
                <button class="dropdown-item py-2 text-danger fw-bold" onclick="logout()">
                  <i class="material-icons align-middle me-2 fs-6">logout</i> Keluar Aplikasi
                </button>
              </li>
            </ul>
          </div>
        </div>
      </header>

      <div class="content-body">

        <div id="page-dashboard" class="page-section">
          <h3 class="page-title mb-4">Ringkasan Bisnis</h3>
          <div class="row g-4">
            <div class="col-md-4">
              <div class="card stat-card">
                <div>
                  <p class="stat-label">Pemasukan</p>
                  <h3 class="stat-value text-success" id="dash-income">Rp 0</h3>
                </div>
                <div class="stat-icon bg-icon-green"><i class="material-icons">trending_up</i></div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card stat-card">
                <div>
                  <p class="stat-label">Pengeluaran</p>
                  <h3 class="stat-value text-danger" id="dash-expense">Rp 0</h3>
                </div>
                <div class="stat-icon bg-icon-red"><i class="material-icons">trending_down</i></div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card stat-card">
                <div>
                  <p class="stat-label">Laba Bersih</p>
                  <h3 class="stat-value text-primary" id="dash-net">Rp 0</h3>
                </div>
                <div class="stat-icon bg-icon-blue"><i class="material-icons">account_balance</i></div>
              </div>
            </div>
          </div>
        </div>

        <div id="page-kasir" class="page-section d-none">
          <div class="row g-0 h-100">
            <div class="col-md-8 pe-md-4">
              <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                  <h4 class="fw-bold m-0">Katalog Produk</h4>
                  <small class="text-muted">Klik produk untuk menambah ke keranjang</small>
                </div>
                <div class="bg-white p-1 rounded-pill shadow-sm border d-flex">
                  <input type="radio" class="btn-check" name="posMode" id="mode-tukar" value="Tukar (Refill)" checked>
                  <label class="btn btn-sm btn-outline-danger rounded-pill px-3 border-0 fw-bold" for="mode-tukar">Refill / Tukar</label>

                  <input type="radio" class="btn-check" name="posMode" id="mode-baru" value="Beli Tabung Baru">
                  <label class="btn btn-sm btn-outline-danger rounded-pill px-3 border-0 fw-bold" for="mode-baru">Tabung Baru</label>
                </div>
              </div>

              <div class="pos-search-bar d-flex align-items-center mb-4">
                <i class="material-icons text-muted me-2">search</i>
                <input type="text" id="cari-produk-pos" class="form-control border-0 p-0 shadow-none" placeholder="Cari nama barang..." onkeyup="filterProdukGrid()">
              </div>

              <div class="grid-scroll-area">
                <div class="row g-3" id="pos-grid-container">
                  </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="card h-100 border-0 shadow-lg d-flex flex-column">
                <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="fw-bold m-0">Order Menu</h5>
                    <span class="badge bg-danger rounded-pill" id="cart-count-badge">0 Item</span>
                  </div>

                  <div class="input-group input-group-sm mb-2 position-relative">
                    <span class="input-group-text bg-light border-0">
                      <i class="material-icons" style="font-size:16px">person</i>
                    </span>
                    <input type="text" id="kasir-pelanggan" class="form-control bg-light border-0 fw-bold text-dark" placeholder="Ketik Nama Pelanggan..." autocomplete="off">
                    <button class="btn btn-light text-primary border-0 btn-animate-bounce" onclick="modalPelanggan(true)">+</button>

                    <div id="hasil-cari-container" class="list-group position-absolute shadow d-none" style="z-index: 1050; max-height: 250px; overflow-y: auto; top: 100%; width: 100%;">
                      </div>
                  </div>
                </div>

                <div class="card-body p-0 overflow-auto" style="flex: 1;">
                  <table class="table table-hover mb-0 align-middle">
                    <tbody id="pos-cart-body"></tbody>
                  </table>
                  <div id="empty-cart-msg" class="text-center text-muted py-5">
                    <i class="material-icons" style="font-size: 48px; color: #eee;">shopping_cart</i>
                    <p class="small mt-2">Keranjang kosong</p>
                  </div>
                </div>

                <div class="card-footer bg-white border-0 p-4 shadow-top">
                  <div class="d-flex justify-content-between mb-1">
                    <span class="text-muted">Subtotal</span>
                    <strong id="pos-subtotal">Rp 0</strong>
                  </div>
                  <div class="d-flex justify-content-between mb-3">
                    <span class="fw-bold fs-5">Total Bayar</span>
                    <span class="fw-bold fs-4 text-primary" id="pos-grand-total">Rp 0</span>
                  </div>

                  <div class="mb-3">
                    <label class="small fw-bold text-muted mb-1">Metode Pembayaran</label>
                    <select id="pos-metode-bayar" class="form-select fw-bold border-secondary">
                      <option value="Tunai" selected>Tunai (Cash)</option>
                      <option value="BCA">Transfer BNI</option>
                      <option value="BCA">Transfer BCA</option>
                      <option value="BRI">Transfer BRI</option>
                      <option value="Mandiri">Transfer Mandiri</option>
                      <option value="QRIS">QRIS / E-Wallet</option>
                      <option value="Hutang">‚ö†Ô∏è Hutang / Bon</option>
                    </select>
                    <div id="box-jatuh-tempo" class="mt-2 d-none">
                      <label class="small fw-bold text-danger">Jatuh Tempo (Janji Bayar)</label>
                      <input type="date" id="pos-jatuh-tempo" class="form-control border-danger text-danger fw-bold">
                    </div>
                  </div>
                  <div class="d-grid gap-2">
                    <button onclick="prosesBayarFinal()" class="btn btn-primary py-3 fw-bold rounded-pill shadow-lg">PROSES BAYAR</button>
                    <button onclick="resetKeranjang()" class="btn btn-light text-danger py-2 rounded-pill small">Batalkan Transaksi</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="page-riwayat-jual" class="page-section d-none">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="page-title">Riwayat Penjualan</h3>
            <button class="btn btn-primary rounded-pill btn-sm px-3" onclick="loadRiwayatJual()">
              <i class="material-icons align-middle" style="font-size:16px">refresh</i> Refresh Data
            </button>
          </div>

          <div class="card p-4 border-0 shadow-sm">
            <div class="row g-2 mb-3 align-items-end">
              <div class="col-md-3">
                <label class="small fw-bold text-muted">Dari Tanggal</label>
                <input type="date" id="filter-jual-start" class="form-control bg-light border-0">
              </div>
              <div class="col-md-3">
                <label class="small fw-bold text-muted">Sampai Tanggal</label>
                <input type="date" id="filter-jual-end" class="form-control bg-light border-0">
              </div>
              <div class="col-md-4">
                <label class="small fw-bold text-muted">Cari ID / Pelanggan</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-0"><i class="material-icons fs-6">search</i></span>
                  <input type="text" id="filter-jual-text" class="form-control bg-light border-0" placeholder="Ketik ID atau Nama...">
                </div>
              </div>
              <div class="col-md-2">
                <button class="btn btn-dark w-100 fw-bold" onclick="terapkanFilter('JUAL')">FILTER</button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-custom table-hover" id="tabel-riwayat-jual">
                <thead class="bg-light">
                  <tr>
                    <th>ID & Waktu</th>
                    <th>Pelanggan</th>
                    <th>Total</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
            <small class="text-muted fst-italic">*Menampilkan 50 transaksi terakhir. Gunakan filter untuk mencari di data yang dimuat.</small>
          </div>
        </div>

        <div id="page-riwayat-beli" class="page-section d-none">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="page-title">Riwayat Pembelian</h3>
            <button class="btn btn-primary rounded-pill btn-sm px-3" onclick="loadRiwayatBeli()">
              <i class="material-icons align-middle" style="font-size:16px">refresh</i> Refresh Data
            </button>
          </div>

          <div class="card p-4 border-0 shadow-sm">
            <div class="row g-2 mb-3 align-items-end">
              <div class="col-md-3">
                <label class="small fw-bold text-muted">Dari Tanggal</label>
                <input type="date" id="filter-beli-start" class="form-control bg-light border-0">
              </div>
              <div class="col-md-3">
                <label class="small fw-bold text-muted">Sampai Tanggal</label>
                <input type="date" id="filter-beli-end" class="form-control bg-light border-0">
              </div>
              <div class="col-md-4">
                <label class="small fw-bold text-muted">Cari ID / Supplier</label>
                <div class="input-group">
                  <span class="input-group-text bg-light border-0"><i class="material-icons fs-6">search</i></span>
                  <input type="text" id="filter-beli-text" class="form-control bg-light border-0" placeholder="Ketik ID atau Supplier...">
                </div>
              </div>
              <div class="col-md-2">
                <button class="btn btn-dark w-100 fw-bold" onclick="terapkanFilter('BELI')">FILTER</button>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-custom table-hover" id="tabel-riwayat-beli">
                <thead class="bg-light">
                  <tr>
                    <th>ID & Waktu</th>
                    <th>Supplier</th>
                    <th>Total</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="page-riwayat-piutang" class="page-section d-none">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="page-title text-danger">Daftar Piutang (Bon)</h3>
            <button class="btn btn-primary rounded-pill btn-sm px-3" onclick="loadPiutang()">
              <i class="material-icons align-middle" style="font-size:16px">refresh</i> Refresh Data
            </button>
          </div>

          <div class="card p-4 border-0 shadow-sm">
            <div class="alert alert-warning small"><i class="material-icons align-middle" style="font-size:16px">info</i> Halaman ini menampilkan transaksi yang statusnya <b>Belum Lunas</b>. Klik tombol <b>LUNASI</b> jika pelanggan membayar.</div>

            <div class="mb-3">
              <div class="input-group">
                <span class="input-group-text bg-white border-end-0"><i class="material-icons text-muted">search</i></span>
                <input type="text" id="cari-piutang" class="form-control border-start-0" placeholder="Cari Nama Pelanggan..." onkeyup="filterTabelPiutang()">
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-custom table-hover" id="tabel-piutang">
                <thead class="bg-light">
                  <tr>
                    <th>Jatuh Tempo</th>
                    <th>Pelanggan</th>
                    <th>Total Tagihan</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>

        <div id="page-produk" class="page-section d-none">
          <div class="d-flex justify-content-between mb-3">
            <h3 class="page-title">Data Produk</h3>
            <button class="btn btn-primary rounded-pill" data-bs-toggle="modal" data-bs-target="#modalProduk">+ Produk Baru</button>
          </div>
          <div class="card p-0 overflow-hidden">
            <table class="table table-custom table-hover m-0" id="tabel-produk">
              <thead class="bg-light">
                <tr>
                  <th>Nama</th>
                  <th>Jual</th>
                  <th>Beli</th>
                  <th>Isi</th>
                  <th>Kosong</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div id="page-pelanggan" class="page-section d-none">
          <div class="d-flex justify-content-between mb-3">
            <h3 class="page-title">Data Pelanggan</h3>
            <button class="btn btn-primary rounded-pill" onclick="modalPelanggan()">+ Pelanggan</button>
          </div>
          <div class="card p-4">
            <input type="text" id="cari-pelanggan" class="form-control mb-3 bg-light border-0" placeholder="Cari Nama / PT..." onkeyup="filterPelanggan()">
            <table class="table table-custom table-hover" id="tabel-pelanggan">
              <thead>
                <tr>
                  <th>Nama</th>
                  <th>Perusahaan</th>
                  <th>Kontak</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div id="page-pembelian" class="page-section d-none">
          <div class="d-flex justify-content-between mb-3">
            <h3 class="page-title">Stok Masuk (Beli)</h3>
            <button class="btn btn-success rounded-pill" data-bs-toggle="modal" data-bs-target="#modalSupplier">+ Supplier Baru</button>
          </div>

          <div class="row">
            <div class="col-md-5">
              <div class="card p-4 h-100">
                <h5 class="fw-bold mb-3 border-bottom pb-2">Input Pembelian</h5>

                <div class="mb-3">
                  <label class="fw-bold small text-muted">Pilih Supplier</label>
                  <select id="beli-supplier" class="form-select bg-light border-0"></select>
                </div>

                <div class="card bg-light p-3 border-0 mb-3">
                  <div class="mb-2">
                    <label class="fw-bold small text-muted">Produk</label>
                    <select id="beli-produk" class="form-select border-0" onchange="updateHargaBeli()"></select>
                  </div>

                  <div class="mb-2">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" id="beli-tukar" checked>
                      <label class="form-check-label small fw-bold" for="beli-tukar">Tukar Tabung Kosong?</label>
                    </div>
                    <small class="text-muted" style="font-size: 11px;">Jika aktif, stok tabung kosong akan berkurang.</small>
                  </div>

                  <div class="row mb-2">
                    <div class="col">
                      <label class="fw-bold small text-muted">Qty</label>
                      <input type="number" id="beli-qty" class="form-control border-0" value="10" oninput="updateHargaBeli()">
                    </div>
                    <div class="col">
                      <label class="fw-bold small text-muted">Harga Beli</label>
                      <input type="number" id="beli-harga" class="form-control border-0">
                    </div>
                  </div>

                  <div class="d-flex justify-content-between align-items-center border-top pt-2 mt-2">
                    <small>Subtotal:</small>
                    <strong class="text-primary" id="beli-subtotal-label">Rp 0</strong>
                  </div>
                </div>

                <button onclick="tambahKeKeranjangBeli()" class="btn btn-primary w-100 rounded-pill fw-bold">+ TAMBAH KE LIST</button>
              </div>
            </div>

            <div class="col-md-7">
              <div class="card p-4 h-100">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h5 class="fw-bold">Daftar Belanja</h5>
                  <button class="btn btn-sm btn-outline-secondary rounded-pill" onclick="resetKeranjangBeli()">Reset</button>
                </div>

                <div class="table-responsive" style="max-height: 350px;">
                  <table class="table table-custom table-hover" id="tabel-keranjang-beli">
                    <thead class="bg-light">
                      <tr>
                        <th>Produk</th>
                        <th>Opsi</th>
                        <th>Qty</th>
                        <th>Total</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>

                <div class="mt-auto border-top pt-3">
                  <div class="d-flex justify-content-between align-items-end mb-3">
                    <span class="text-muted">Total Tagihan</span>
                    <h2 class="fw-bold text-danger m-0" id="label-grand-total-beli">Rp 0</h2>
                  </div>
                  <button onclick="prosesBeliFinal()" class="btn btn-danger w-100 py-3 fw-bold rounded-pill shadow">SIMPAN STOK</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="page-keuangan" class="page-section d-none">
          <div class="d-flex justify-content-between mb-3">
            <h3 class="page-title">Arus Kas</h3>
            <button class="btn btn-primary rounded-pill" onclick="bukaModalKeuangan()">+ Catat Kas</button>
          </div>
          <div class="card p-0">
            <table class="table table-custom table-hover m-0" id="tabel-keuangan">
              <thead class="bg-light">
                <tr>
                  <th>Tanggal</th>
                  <th>Jenis</th>
                  <th>Kategori</th>
                  <th>Nominal</th>
                  <th>Ket</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div id="page-payroll" class="page-section d-none">
          <h3 class="page-title mb-4">Manajemen SDM</h3>
          <div class="card p-4">
            <ul class="nav nav-pills mb-4 gap-2" id="payrollTabs">
              <li class="nav-item"><button class="btn btn-outline-danger active rounded-pill px-4" onclick="switchTab('karyawan')">Data Karyawan</button></li>
              <li class="nav-item"><button class="btn btn-outline-danger rounded-pill px-4" onclick="switchTab('kasbon')">Kasbon</button></li>
              <li class="nav-item"><button class="btn btn-outline-danger rounded-pill px-4" onclick="switchTab('gaji')">Hitung Gaji</button></li>
            </ul>

            <div id="tab-karyawan" class="tab-content">
              <div class="d-flex justify-content-between mb-2">
                <h5>List Karyawan</h5><button class="btn btn-success btn-sm rounded-pill" onclick="modalKaryawan()">+ Tambah</button>
              </div>
              <table class="table table-custom" id="tabel-karyawan">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>HP</th>
                    <th>Gaji</th>
                    <th>Bonus</th>
                    <th>Aksi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>

            <div id="tab-kasbon" class="tab-content d-none">
              <div class="row">
                <div class="col-md-4">
                  <div class="card bg-light p-3 border-0">
                    <h6 class="fw-bold">Input Kasbon</h6>
                    <select id="kasbon-nama" class="form-select mb-2"></select>
                    <input type="number" id="kasbon-nominal" class="form-control mb-2" placeholder="Nominal">
                    <input id="kasbon-ket" class="form-control mb-2" placeholder="Ket">
                    <button onclick="simpanKasbon()" class="btn btn-warning w-100">Simpan</button>
                  </div>
                </div>
                <div class="col-md-8">
                  <h6>Riwayat Belum Lunas</h6>
                  <table class="table table-custom" id="tabel-kasbon">
                    <thead>
                      <tr>
                        <th>Tgl</th>
                        <th>Nama</th>
                        <th>Jml</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>

            <div id="tab-gaji" class="tab-content d-none">
              <button class="btn btn-success mb-3 w-100 rounded-pill" onclick="loadHitungGaji()">üîÑ Hitung Gaji Bulan Ini</button>
              <table class="table table-custom table-bordered" id="tabel-hitung-gaji">
                <thead>
                  <tr>
                    <th>Nama</th>
                    <th>Gaji</th>
                    <th>Bonus</th>
                    <th>Kasbon</th>
                    <th>Terima</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <button onclick="cairkanGaji()" class="btn btn-primary w-100 mt-2 fw-bold rounded-pill">CAIRKAN & CATAT</button>
            </div>
          </div>
        </div>

        <div id="page-laporan" class="page-section d-none">
          <h3 class="page-title">Laporan Profit</h3>
          <div class="card p-5 text-center">
            <h1 class="text-success display-3 fw-bold" id="lap-net">Rp 0</h1>
            <p class="text-muted">Total Keuntungan Bersih (All Time)</p>
          </div>
        </div>

      </div> </div> </div> <div class="modal fade" id="modalProduk" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5>Produk</h5><button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-2">
            <div class="col-6">
              <label class="small fw-bold">SKU</label>
              <input id="prod-sku" class="form-control" placeholder="Cth: GAS-3KG">
            </div>
            <div class="col-6">
              <label class="small fw-bold">Kode Produk</label>
              <input id="prod-kode" class="form-control" placeholder="Barcode/Kode">
            </div>
          </div>

          <label class="small fw-bold">Nama Produk</label>
          <input id="prod-nama" class="form-control mb-2" placeholder="Nama Produk">

          <label class="small fw-bold">Link Gambar (URL)</label>
          <label class="small fw-bold">Upload Gambar Produk</label>
          <input type="file" id="prod-file-gambar" class="form-control mb-2" accept="image/*" onchange="tampilkanPreview(this)">

          <div class="text-center mb-3">
            <img id="img-preview" src="" class="d-none rounded border shadow-sm" style="max-height: 200px; max-width: 100%; object-fit: contain;">
          </div>

          <div id="loading-upload" class="text-primary small d-none">
            <div class="spinner-border spinner-border-sm" role="status"></div> Sedang memproses...
          </div>
          <small class="text-muted d-block mb-2" style="font-size:10px">Gambar akan disimpan di Google Drive Anda.</small>
          <small class="text-muted d-block mb-2" style="font-size:10px">Salin link gambar dari internet/Google Drive (Pastikan link publik).</small>

          <div class="row mb-2">
            <div class="col-6">
              <label class="small fw-bold">Harga Jual</label>
              <input id="prod-jual" type="number" class="form-control" placeholder="0">
            </div>
            <div class="col-6">
              <label class="small fw-bold">Harga Beli</label>
              <input id="prod-beli" type="number" class="form-control" placeholder="0">
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label class="small fw-bold">Stok Isi</label>
              <input id="prod-isi" type="number" class="form-control" placeholder="0">
            </div>
            <div class="col">
              <label class="small fw-bold">Stok Kosong</label>
              <input id="prod-kosong" type="number" class="form-control" placeholder="0">
            </div>
          </div>
        </div>
        <div class="modal-footer border-top-0">
          <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-primary fw-bold rounded-pill px-4" onclick="simpanProduk()">SIMPAN PRODUK</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalKaryawan" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5>Karyawan</h5><button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="kry-id">
          <input id="kry-nama" class="form-control mb-2" placeholder="Nama">
          <input id="kry-hp" class="form-control mb-2" placeholder="HP">
          <input id="kry-gaji" type="number" class="form-control mb-2" placeholder="Gaji Pokok">
          <input id="kry-bonus" type="number" class="form-control mb-2" placeholder="Bonus">
        </div>
        <div class="modal-footer"><button onclick="simpanKaryawanDB()" class="btn btn-primary">Simpan</button></div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalSupplier" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5>Supplier</h5><button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body"><input id="sup-nama" class="form-control mb-2" placeholder="Nama"><input id="sup-hp" class="form-control mb-2" placeholder="HP"><input id="sup-alamat" class="form-control" placeholder="Alamat"></div>
        <div class="modal-footer"><button onclick="simpanSupplier()" class="btn btn-primary">Simpan</button></div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalKeuangan" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5>Catat Keuangan</h5><button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <select id="keu-jenis" class="form-select mb-2">
            <option>Pengeluaran</option>
            <option>Pemasukan</option>
          </select>
          <div class="input-group mb-2"><select id="keu-kategori" class="form-select"></select><button class="btn btn-outline-secondary" onclick="tambahKategoriBaru()">+</button></div>
          <input type="number" id="keu-nominal" class="form-control mb-2" placeholder="Rp">
          <input id="keu-ket" class="form-control" placeholder="Keterangan">
        </div>
        <div class="modal-footer"><button onclick="simpanKeuangan()" class="btn btn-primary">Simpan</button></div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalPelanggan" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="fw-bold">Form Pelanggan</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="pel-id">
          <div class="mb-2"><label>Nama Kontak</label><input id="pel-nama" class="form-control" placeholder="Cth: Bpk. Budi"></div>
          <div class="mb-2"><label>Nama Perusahaan / Toko</label><input id="pel-pt" class="form-control" placeholder="Cth: PT. Maju Jaya"></div>
          <div class="mb-2"><label>No HP / WA</label><input id="pel-hp" class="form-control" type="number"></div>
          <div class="mb-2"><label>Alamat Lengkap</label><textarea id="pel-alamat" class="form-control" rows="3"></textarea></div>
        </div>
        <div class="modal-footer"><button onclick="simpanPelangganDB()" class="btn btn-primary w-100">SIMPAN DATA</button></div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalFormRetur" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-danger text-white">
          <h5 class="modal-title">Form Retur Barang</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-warning py-2 mb-3 small"><i class="material-icons align-middle" style="font-size:16px">warning</i> Stok akan dikembalikan (Jual) atau dikurangi (Beli).</div>
          <input type="hidden" id="retur-id-trx"><input type="hidden" id="retur-jenis-trx">
          <label class="fw-bold mb-2">Pilih Barang & Jumlah Retur:</label>
          <div id="container-retur-items" class="border rounded p-2 bg-light" style="max-height:300px; overflow-y:auto;"></div>
          <div class="mt-3 form-check">
            <input class="form-check-input" type="checkbox" id="check-retur-semua" onchange="toggleReturSemua()">
            <label class="form-check-label fw-bold" for="check-retur-semua">Retur Seluruh Transaksi (Batalkan)</label>
          </div>
          <div class="mt-2"><label class="small">Alasan Retur</label><input type="text" id="retur-alasan" class="form-control" placeholder="Alasan..."></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-danger fw-bold" onclick="prosesSimpanRetur()">PROSES RETUR</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="globalModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header text-white" id="globalModalHeader">
          <h5 class="modal-title fw-bold" id="globalModalTitle">Pemberitahuan</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="d-flex align-items-center">
            <i class="material-icons me-3" id="globalModalIcon" style="font-size: 40px;">info</i>
            <p class="mb-0 fs-6" id="globalModalBody">Pesan...</p>
          </div>
        </div>
        <div class="modal-footer border-0 bg-light">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="btn-cancel">Batal</button>
          <button type="button" class="btn btn-primary fw-bold px-4" id="btn-confirm">YA</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalDetailTrx" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">Detail Transaksi</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-3 border-bottom pb-2">
            <div class="col-6"><small class="text-muted">ID Transaksi</small><br><strong id="det-id">-</strong></div>
            <div class="col-6 text-end"><small class="text-muted">Waktu</small><br><span id="det-waktu">-</span></div>
            <div class="col-12 mt-2"><small class="text-muted">Pelanggan</small><br><strong id="det-pelanggan" class="text-primary">-</strong></div>
          </div>
          <table class="table table-sm table-bordered" id="tabel-detail-trx">
            <thead class="table-light">
              <tr>
                <th>Item</th>
                <th class="text-center">Qty</th>
                <th class="text-end">Total</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div class="d-flex justify-content-between align-items-center mt-3">
            <span class="fs-5">Total Bayar:</span>
            <span class="fs-4 fw-bold text-success" id="det-total">Rp 0</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalInputQty" tabindex="-1">
    <div class="modal-dialog modal-sm modal-dialog-centered">
      <div class="modal-content shadow-lg border-0">
        <div class="modal-header border-0 pb-0 justify-content-center">
          <h6 class="modal-title fw-bold text-center" id="qty-modal-title">Nama Produk</h6>
        </div>
        <div class="modal-body text-center">
          <label class="small text-muted mb-2">Masukkan Jumlah (Qty)</label>
          <input type="number" id="input-qty-pos" class="form-control form-control-lg text-center fw-bold fs-2 text-primary border-primary" value="1" min="1">
          <div class="small text-danger mt-1 d-none" id="qty-msg-error">Stok tidak cukup!</div>
        </div>
        <div class="modal-footer border-0 pt-0">
          <div class="row w-100 g-2">
            <div class="col-6">
              <button type="button" class="btn btn-light w-100 rounded-pill" data-bs-dismiss="modal">Batal</button>
            </div>
            <div class="col-6">
              <button type="button" class="btn btn-primary w-100 rounded-pill fw-bold" onclick="submitQtyPOS()">ENTER</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalInvoice" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header border-0 pb-0 no-print">
          <h5 class="modal-title fw-bold">Faktur Penjualan</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="tutupInvoice()"></button>
        </div>

        <div class="modal-body p-4" id="area-cetak">
          <div class="d-flex justify-content-between border-bottom border-3 border-dark pb-3 mb-3">
            <div>
              <h2 class="fw-bold text-danger m-0">PT. KINGKONG BERKAH AMANAH</h2>
              <small class="text-muted fw-bold">DISTRIBUTOR GAS & AIR MINERAL</small><br>
              <small class="text-muted" style="font-size:12px">Jl. Pejuang 1, Indonesia</small>
            </div>
            <div class="text-end">
              <h4 class="fw-bold text-dark">INVOICE</h4>
              <div class="text-muted" id="inv-date">Tgl: -</div>
              <div class="text-danger fw-bold" id="inv-no">NO: -</div>
            </div>
          </div>

          <div class="row mb-4">
            <div class="col-6">
              <small class="text-muted fw-bold text-uppercase">Kepada Yth:</small>
              <h5 class="fw-bold text-dark mb-0" id="inv-pelanggan">-</h5>
              <small class="text-muted" id="inv-metode">Pembayaran: -</small>
            </div>
            <div class="col-6 text-end">
              <small class="text-muted fw-bold text-uppercase">Kasir:</small>
              <div class="fw-bold text-dark" id="inv-kasir">-</div>
            </div>
          </div>

          <table class="table table-bordered border-dark mb-0" style="border-color: #000 !important;">
            <thead class="bg-light text-center">
              <tr style="border-bottom: 2px solid #000;">
                <th style="width: 40%;">Nama Barang</th>
                <th>Harga</th>
                <th>Qty</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody id="inv-items-body" class="text-center"></tbody>
            <tfoot class="fw-bold">
              <tr>
                <td colspan="3" class="text-end pe-3">GRAND TOTAL</td>
                <td class="text-end bg-light" id="inv-grand-total">Rp 0</td>
              </tr>
            </tfoot>
          </table>

          <div class="row mt-4">
            <div class="col-8">
              <small class="text-muted fst-italic" style="font-size:11px;">
                * Barang yang sudah dibeli tidak dapat ditukar/dikembalikan (kecuali perjanjian retur).<br>
                * Harap simpan bukti pembayaran ini sebagai bukti transaksi yang sah.
              </small>
            </div>
            <div class="col-4 text-center mt-3">
              <small class="fw-bold">Hormat Kami,</small>
              <br><br><br>
              <small class="text-muted">( Admin Keuangan )</small>
            </div>
          </div>
        </div>

        <div class="modal-footer no-print bg-light">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="tutupInvoice()">Tutup</button>
          <button type="button" class="btn btn-primary fw-bold px-4" onclick="window.print()">
            <i class="material-icons align-middle" style="font-size:18px">print</i> CETAK FAKTUR
          </button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="modalCekTabung" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header bg-warning text-dark border-0">
          <h5 class="modal-title fw-bold">
            <i class="material-icons align-middle me-2">verified_user</i>Verifikasi Tabung
          </h5>
        </div>
        <div class="modal-body p-4 text-center">
          <p class="mb-2 text-muted">Transaksi ini mengandung <b id="lbl-qty-refill">0</b> item Refill.</p>
          <h5 class="fw-bold mb-3 text-dark">Berapa tabung kosong yang diterima?</h5>

          <div class="d-flex justify-content-center align-items-center gap-2 mb-3">
            <input type="number" id="input-fisik-tabung" class="form-control form-control-lg text-center fw-bold fs-1 border-warning text-warning" style="width: 120px; height: 80px;" placeholder="0">
          </div>

          <div id="msg-error-tabung" class="alert alert-danger d-none small py-2">
            <i class="material-icons align-middle" style="font-size:16px">error</i>
            Jumlah tidak sesuai! <br> Harap terima sesuai pesanan atau ubah item jadi 'Tabung Baru'.
          </div>

          <small class="text-muted fst-italic">*Kasir wajib menghitung fisik tabung sebelum lanjut.</small>
        </div>
        <div class="modal-footer border-0 justify-content-center pb-4">
          <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-dark rounded-pill px-5 fw-bold" onclick="validasiTabung()">LANJUT BAYAR</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <?!= include('javascript'); ?>
</body>
</html>
